<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Linux Bangla Type v2.0 (Phone to PC)</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali&display=swap" rel="stylesheet">

  <!-- html2pdf.js for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    body {
      font-family: 'Noto Sans Bengali', sans-serif;
      transition: background 0.3s ease, color 0.3s ease;
      background-color: #f0f9ff;
      color: #1e293b;
    }

    .dark-mode {
      background-color: #1e293b;
      color: #f1f5f9;
    }

    .dark-mode textarea,
    .dark-mode select {
      background-color: #334155;
      color: #f8fafc;
      border-color: #475569;
    }

    textarea:focus {
      outline: none;
      box-shadow: 0 0 0 3px #60a5fa;
    }

    .fade-in {
      animation: fadeIn 0.8s ease-in-out both;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Push-to-talk button active style */
    #pushTalkBtn.active {
      background-color: #059669 !important; /* Emerald green */
      box-shadow: 0 0 10px #10b981;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% {
        box-shadow: 0 0 10px #10b981;
      }
      50% {
        box-shadow: 0 0 20px #10b981;
      }
    }

    /* Scrollbar styling */
    textarea::-webkit-scrollbar {
      width: 8px;
    }

    textarea::-webkit-scrollbar-thumb {
      background-color: #60a5fa;
      border-radius: 10px;
    }
  </style>
</head>

<body class="min-h-screen flex flex-col fade-in" id="body">

  <!-- Header -->
  <header class="bg-blue-800 text-white py-5 shadow-md">
    <div class="text-center text-3xl font-bold">Linux Bangla Type v2.0</div>
    <p class="text-center text-sm text-blue-200 mt-1">Phone to PC | Voice Typing | ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ, English, ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</p>
  </header>

  <!-- Main Section -->
  <main class="flex-grow container mx-auto px-4 py-6 max-w-4xl fade-in">
    <!-- Control Buttons -->
    <div class="mb-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-7 gap-3">
      <select id="languageSelect" class="rounded-xl p-2 text-sm border shadow focus:ring focus:ring-blue-300">
        <option value="bn-BD">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂)</option>
        <option value="bn-IN">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (‡¶≠‡¶æ‡¶∞‡¶§)</option>
        <option value="hi-IN">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
        <option value="en-US" selected>English (US)</option>
        <option value="en-GB">English (UK)</option>
        <option value="ur-PK">ÿßÿ±ÿØŸà</option>
      </select>

      <button id="startBtn" class="rounded-xl bg-green-600 hover:bg-green-700 text-white py-2 px-4 shadow transition-all duration-200">
        üé§ Start
      </button>

      <button id="stopBtn" class="rounded-xl bg-red-600 hover:bg-red-700 text-white py-2 px-4 shadow transition-all duration-200" disabled>
        ‚õî Stop
      </button>

      <button id="clearBtn" class="rounded-xl bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 shadow transition-all duration-200">
        üßπ Clear
      </button>

      <button id="copyBtn" class="rounded-xl bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 shadow transition-all duration-200">
        üìã Copy
      </button>

      <button id="exportTxtBtn" class="rounded-xl bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 shadow transition-all duration-200">
        üìÑ Export .txt
      </button>

      <button id="exportPdfBtn" class="rounded-xl bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-4 shadow transition-all duration-200">
        üßæ Export .pdf
      </button>
    </div>

    <!-- Push-to-Talk Button -->
    <div class="mb-4 flex justify-center">
      <button id="pushTalkBtn" class="rounded-full bg-gray-800 text-white py-3 px-8 shadow-lg hover:bg-gray-900 transition-all duration-200 select-none">
        üéôÔ∏è Hold to Talk
      </button>
    </div>

    <!-- Textarea -->
    <textarea id="textArea" rows="14" class="w-full rounded-xl p-4 text-lg leading-relaxed border shadow resize-none bg-white dark-mode:bg-slate-700 dark-mode:text-white" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶•‡¶æ ‡¶ü‡¶æ‡¶á‡¶™ ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá..."></textarea>

    <!-- Status -->
    <p id="status" class="mt-2 text-sm text-gray-700 dark-mode:text-gray-300"></p>

    <!-- History Section -->
    <div class="mt-6 bg-gray-100 dark-mode:bg-slate-800 p-4 rounded-xl shadow">
      <div class="flex justify-between items-center mb-2">
        <h3 class="text-lg font-semibold text-gray-800 dark-mode:text-gray-200">Typing History</h3>
        <button id="clearHistoryBtn" class="text-red-600 hover:text-red-800 dark-mode:text-red-400 dark-mode:hover:text-red-600 transition-colors text-sm">Clear History</button>
      </div>
      <div id="historyContainer" class="max-h-48 overflow-y-auto p-2 bg-white dark-mode:bg-slate-900 rounded shadow-inner text-sm text-gray-700 dark-mode:text-gray-300 whitespace-pre-wrap font-mono"></div>
    </div>

    <!-- Dark Mode Toggle -->
    <div class="mt-6 flex justify-end">
      <button id="toggleDarkMode" class="rounded-full bg-black/80 hover:bg-black text-white px-4 py-2 shadow transition-all duration-200">
        üåô Toggle Dark Mode
      </button>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-200 text-center text-gray-700 py-3 text-sm dark-mode:bg-slate-800 dark-mode:text-gray-300">
    ¬© 2025 ‚Äì Crafted by Yusuf Adnan | AI Assistant Supported
  </footer>

  <!-- JavaScript -->
  <script>
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const clearBtn = document.getElementById('clearBtn');
    const copyBtn = document.getElementById('copyBtn');
    const exportTxtBtn = document.getElementById('exportTxtBtn');
    const exportPdfBtn = document.getElementById('exportPdfBtn');
    const textArea = document.getElementById('textArea');
    const status = document.getElementById('status');
    const languageSelect = document.getElementById('languageSelect');
    const toggleDarkMode = document.getElementById('toggleDarkMode');
    const body = document.getElementById('body');
    const pushTalkBtn = document.getElementById('pushTalkBtn');
    const historyContainer = document.getElementById('historyContainer');
    const clearHistoryBtn = document.getElementById('clearHistoryBtn');

    let recognition;
    let recognizing = false;
    let finalTranscript = '';
    let typingHistory = [];

    // Load history from localStorage on page load
    window.addEventListener('load', () => {
      const savedHistory = localStorage.getItem('typingHistory');
      if (savedHistory) {
        typingHistory = JSON.parse(savedHistory);
        renderHistory();
      }
      // Load dark mode preference
      if(localStorage.getItem('darkMode') === 'true') {
        body.classList.add('dark-mode');
      }
    });

    // Save history to localStorage
    function saveHistory() {
      localStorage.setItem('typingHistory', JSON.stringify(typingHistory));
    }

    // Render history in historyContainer
    function renderHistory() {
      if (typingHistory.length === 0) {
        historyContainer.textContent = '‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡¶æ‡¶á‡¶™‡¶ø‡¶Ç ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶®‡ßá‡¶á‡•§';
        return;
      }
      historyContainer.textContent = '';
      typingHistory.forEach((entry, i) => {
        const div = document.createElement('div');
        div.textContent = entry;
        div.className = "mb-2 border-b border-gray-300 dark-mode:border-gray-600 pb-1";
        historyContainer.appendChild(div);
      });
    }

    // Dark Mode Toggle
    toggleDarkMode.addEventListener('click', () => {
      body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', body.classList.contains('dark-mode'));
    });

    // Check for browser support
    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
      status.textContent = '‚ö†Ô∏è ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ voice typing ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡•§ Chrome ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§';
      startBtn.disabled = true;
      pushTalkBtn.disabled = true;
    } else {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = true;
      recognition.lang = languageSelect.value;

      recognition.onstart = () => {
        recognizing = true;
        status.textContent = 'üéôÔ∏è ‡¶ü‡¶æ‡¶á‡¶™‡¶ø‡¶Ç ‡¶ö‡¶≤‡¶õ‡ßá...';
        startBtn.disabled = true;
        stopBtn.disabled = false;
        languageSelect.disabled = true;
        pushTalkBtn.classList.add('active');
      };

      recognition.onerror = (event) => {
        status.textContent = '‚ùó ‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + event.error;
      };

      recognition.onend = () => {
        recognizing = false;
        status.textContent = '‚õî ‡¶ü‡¶æ‡¶á‡¶™‡¶ø‡¶Ç ‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§';
        startBtn.disabled = false;
        stopBtn.disabled = true;
        languageSelect.disabled = false;
        pushTalkBtn.classList.remove('active');
        // Save final text to history on stop
        if(finalTranscript.trim().length > 0) {
          typingHistory.push(finalTranscript.trim());
          saveHistory();
          renderHistory();
        }
      };

      recognition.onresult = (event) => {
  let interimTranscript = '';
  let newFinal = '';

  for (let i = event.resultIndex; i < event.results.length; ++i) {
    const transcript = event.results[i][0].transcript.trim();
    if (event.results[i].isFinal) {
      newFinal += transcript + ' ';
    } else {
      interimTranscript += transcript + ' ';
    }
  }

  // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶Ç‡¶∂ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßã ‡¶Ø‡¶æ‡¶§‡ßá ‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã ‡¶Ö‡¶Ç‡¶∂ ‡¶¨‡¶æ‡¶∞‡¶¨‡¶æ‡¶∞ ‡¶®‡¶æ ‡¶Ü‡¶∏‡ßá
  if (newFinal && !finalTranscript.endsWith(newFinal)) {
    finalTranscript += newFinal;
  }

  textArea.value = finalTranscript + interimTranscript;
  textArea.scrollTop = textArea.scrollHeight;
};

    // Start button
    startBtn.addEventListener('click', () => {
      if (!recognizing) {
        finalTranscript = textArea.value;
        recognition.lang = languageSelect.value;
        recognition.start();
      }
    });

    // Stop button
    stopBtn.addEventListener('click', () => {
      if (recognizing) recognition.stop();
    });

    // Clear button
    clearBtn.addEventListener('click', () => {
      if(recognizing) recognition.stop();
      textArea.value = '';
      finalTranscript = '';
      status.textContent = '';
    });

    // Copy button
    copyBtn.addEventListener('click', () => {
      textArea.select();
      document.execCommand('copy');
      status.textContent = '‚úÖ ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá ‡¶ó‡ßá‡¶õ‡ßá!';
      setTimeout(() => { status.textContent = ''; }, 1500);
    });

    // Export TXT button
    exportTxtBtn.addEventListener('click', () => {
      const text = textArea.value;
      if(!text.trim()) {
        status.textContent = '‚ö†Ô∏è ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!';
        return;
      }
      const blob = new Blob([text], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'typed-text.txt';
      a.click();
    });

    // Export PDF button
    exportPdfBtn.addEventListener('click', () => {
      const text = textArea.value;
      if(!text.trim()) {
        status.textContent = '‚ö†Ô∏è ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!';
        return;
      }
      const opt = {
        margin:       0.5,
        filename:     'typed-text.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
      };
      html2pdf().from(textArea).set(opt).save();
    });

    // Language change
    languageSelect.addEventListener('change', () => {
      if (recognizing) recognition.stop();
      recognition.lang = languageSelect.value;
    });

    // Push-to-Talk: Hold to talk button logic
    pushTalkBtn.addEventListener('mousedown', () => {
      if (!recognizing) {
        finalTranscript = textArea.value;
        recognition.lang = languageSelect.value;
        recognition.start();
      }
    });

    pushTalkBtn.addEventListener('mouseup', () => {
      if (recognizing) recognition.stop();
    });

    pushTalkBtn.addEventListener('touchstart', (e) => {
      e.preventDefault();
      if (!recognizing) {
        finalTranscript = textArea.value;
        recognition.lang = languageSelect.value;
        recognition.start();
      }
    });

    pushTalkBtn.addEventListener('touchend', (e) => {
      e.preventDefault();
      if (recognizing) recognition.stop();
    });

    // Optional keyboard shortcut for push-to-talk (Spacebar)
    window.addEventListener('keydown', (e) => {
      if (e.code === 'Space' && !recognizing && !e.repeat) {
        e.preventDefault();
        finalTranscript = textArea.value;
        recognition.lang = languageSelect.value;
        recognition.start();
        pushTalkBtn.classList.add('active');
      }
    });

    window.addEventListener('keyup', (e) => {
      if (e.code === 'Space' && recognizing) {
        e.preventDefault();
        recognition.stop();
        pushTalkBtn.classList.remove('active');
      }
    });
  </script>
</body>
</html>
